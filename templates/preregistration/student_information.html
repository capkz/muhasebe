{% extends 'base.html' %}

{% block content %}

<style>
    fieldset {
        position:relative;
    }

    fieldset:not(:first-of-type){
        display: none;
    }
    .active_form {
        background: #dbdbdb
    }
</style>
<form class="student_form" id="student_form" enctype="multipart/form-data" method="POST">{% csrf_token %}
    <div class="d-flex justify-content-around border-bottom mb-2" id="step_btns">
        <button type="button" class="btn btn-default steps active_form" id="f_btn">Student Details</button>
        <button type="button" class="btn btn-default steps" id="s_btn">Family Details</button>
        <button type="button" class="btn btn-default steps" id="l_btn">Transportation Details</button>
    </div>
    <div class="container">
        <div class="row">
            <ul class="col-4" id="feedbackmessage"></ul>
        </div>
    </div>
    <fieldset id="std_details">
        <legend>Student Details</legend>
        <p>
            {{ student_form.name.label}}
            {{ student_form.name}}
        </p>
        <p>
            {{ student_form.surname.label}}
            {{ student_form.surname}}
        </p>
        <p>
            {{ student_form.email.label}}
            {{ student_form.email}}
        </p>
        <p>
            {{ student_form.birth_date.label}}
            {{ student_form.birth_date}}
        </p>
        <br><br>
        <input type="button" name="next" class="next btn btn-default" value="Next" />
        <input type="submit" name="submit_student_details" class="btn btn-default" value="Submit"/>
    </fieldset>
    <fieldset id="family_details">
        <legend>Family Details</legend>
        <div>
            <legend>Mom</legend>
        </div>
        <div>
            <legend>Dad</legend>
        </div>
        <br><br>
        <input type="button" name="previous" class="previous btn btn-default" value="Previous" />
        <input type="button" name="next" class="next btn btn-default" value="Next" />
        <input type="submit" name="Submit" class="btn btn-default" value="Submit" />
    </fieldset>
    <fieldset id="transport_details">
        <legend>Transportation Details</legend>
        <label for="fname">First name:</label>
        <input type="text" id="fname" name="fname"><br><br>
        <input type="button" name="previous" class="previous btn btn-default" value="Previous" />
        <input type="submit" name="Submit" class="btn btn-default" value="Submit" />
    </fieldset>
</form>

<script>
    var current_fs, next_fs, previous_fs;
    var current_step, next_step, previous_step;
    
    function titleCase(str) {
        var splitStr = str.toLowerCase().split(' ');
        for (var i = 0; i < splitStr.length; i++) {
            splitStr[i] = splitStr[i].charAt(0).toUpperCase() + splitStr[i].substring(1);     
        }
        return splitStr.join(' '); 
    }

    $(document).on('submit','#student_form',function(e){
        var button_id = '#'+e.target.id;
        e.preventDefault();
        $("#feedbackmessage").empty();
        $.ajax({
            type:'POST',
            data:{formData: $(button_id).parent().find('input').serialize(),
                  csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                  button: e.target.name,
                  },
            success:function(response){
                console.log(response);
                if(response['error']) {
                    for(var key in response.error){
                        var field_name = key.replace("_"," ");
                        console.log('[error] for ' + key + ': ' + response.error[key][0]);
                    }
                }
            }
        });
    });


    $(".steps").click(function(e){ 
        var show_fs;
        clicked_btn = "#"+e.target.id;
        $(".student_form").children().hide();
        switch(clicked_btn){
            case "#f_btn":
                show_fs = "#std_details";
                break;
            case "#s_btn":
                show_fs = "#family_details";
                break;
            case "#l_btn":
                show_fs = "#transport_details";
                break;
            default:
                alert("Case didnt work");
        }
        $(show_fs).show();
        $("#step_btns").children().removeClass("active_form");
        $(clicked_btn).addClass("active_form");
    })

    $(".next").click(function(){
        current_fs = $(this).parent();
        next_fs = $(this).parent().next();
        current_step = $('.active_form');
        next_step = current_step.next();

        current_fs.hide();
        current_step.removeClass('active_form');
        next_fs.show();
        next_step.addClass('active_form');

    })

    $(".previous").click(function(){
        current_fs = $(this).parent();
        previous_fs = $(this).parent().prev();
        current_step = $('.active_form');
        previous_step = current_step.prev();

        current_fs.hide();
        current_step.removeClass('active_form');
        previous_fs.show();
        previous_step.addClass('active_form');
    })
</script>
{% endblock %}